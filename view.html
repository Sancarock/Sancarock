<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rádio Sancarock</title>
<style>
body {
  margin: 0;
  font-family: 'Bebas Neue', Arial, sans-serif;
  background: radial-gradient(circle at center, #ff4500, #800080, #000);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.album-cover {
  width: 130px;
  border-radius: 16px;
  border: 3px solid #ff4500;
  margin: 20px auto;
}

.player-container {
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  padding: 25px;
  width: 90%;
  max-width: 460px;
  text-align: center;
}

.track-info { margin-top: 15px; font-size: 20px; color: yellow; }

.controls button {
  padding: 10px 15px;
  margin: 5px;
  border-radius: 15px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}
.play-button { background: green; color: white; }
.pause-button { background: red; color: white; }
</style>
</head>
<body>

<div class="player-container">
  <img id="albumCover" src="img/tocar.png" alt="Capa do Álbum" class="album-cover">
  <p id="trackTitle">Se não iniciar, Clique em Play</p>
  <p id="artistName"></p>

  <div class="controls">
    <button id="playPauseBtn" class="play-button">Play</button>
  </div>

  <audio id="radioPlayer" preload="auto"></audio>
</div>

<script>
const radioPlayer = document.getElementById('radioPlayer');
const playPauseBtn = document.getElementById('playPauseBtn');
const trackTitle = document.getElementById('trackTitle');
const artistName = document.getElementById('artistName');
const albumCover = document.getElementById('albumCover');

let streamUrl = '';
let isPlaying = false;

// -------------------- CARREGA .PLS --------------------
async function loadPLS() {
  try {
    const res = await fetch('listen.pls');
    const text = await res.text();
    const match = text.match(/File1=(.*)/);
    if(match && match[1]) {
      streamUrl = match[1].trim();
      radioPlayer.src = streamUrl;
    }
  } catch(e) {
    console.error('Erro ao carregar listen.pls', e);
  }
}

// -------------------- METADADOS --------------------
async function fetchMetadata() {
  if(!streamUrl) return;
  try {
    const res = await fetch('https://transmissaodigital.com/api/VG1wamVFNW5QVDA9KzU=');
    const buffer = await res.arrayBuffer();
    const decoder = new TextDecoder('iso-8859-1');
    let text = decoder.decode(buffer);

    let kbpsIndex = text.lastIndexOf('Kbps');
    if(kbpsIndex === -1) return;

    let afterKbps = text.slice(kbpsIndex + 4)
                         .replace(/https?:\/\/[^\s]*/g, '')
                         .replace(/<[^>]*>/g, '')
                         .trim();

    function decodeHTMLEntities(str) {
      const txt = document.createElement("textarea");
      txt.innerHTML = str;
      return txt.value;
    }
    afterKbps = decodeHTMLEntities(afterKbps);

    if(!afterKbps) return;

    let artist = '', track = '';
    if(afterKbps.includes(' - ')) {
      [artist, track] = afterKbps.split(' - ',2).map(s => s.trim());
    } else {
      trackTitle.innerText = 'Rádio Sanca Rock';
      artistName.innerText = '';
      albumCover.src = 'img/sanca.png';
      return;
    }

    trackTitle.innerText = `${artist} - ${track}`;
    artistName.innerText = '';
    albumCover.src = 'img/sanca.png'; // Pode adaptar para pegar capa real

  } catch(e) {
    console.error('Erro ao buscar metadados', e);
  }
}

// -------------------- CONTROLE PLAY/PAUSE --------------------
playPauseBtn.addEventListener('click', async () => {
  if(!streamUrl) await loadPLS();
  if(!streamUrl) return alert('Stream não disponível.');

  if(isPlaying) {
    radioPlayer.pause();
    playPauseBtn.textContent = 'Play';
    playPauseBtn.className = 'play-button';
    isPlaying = false;
  } else {
    try {
      await radioPlayer.play();
      playPauseBtn.textContent = 'Pause';
      playPauseBtn.className = 'pause-button';
      isPlaying = true;
      fetchMetadata();
      setInterval(fetchMetadata, 30000);
    } catch(e) {
      console.warn('Autoplay bloqueado', e);
    }
  }
});
</script>

</body>
</html>


