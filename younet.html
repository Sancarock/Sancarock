<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Playlist Aleat√≥ria</title>
  <style>
    /* ‚úÖ Remove barra de rolagem */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* üî• Esconde scroll */
      background: #000;
      font-family: Arial, sans-serif;
    }

    /* Player ocupa toda a tela menos o espa√ßo dos bot√µes */
    #player {
      width: 100%;
      height: calc(100vh - 80px); /* Deixa espa√ßo embaixo pro controle */
      background: #000;
    }

    /* √Årea dos bot√µes, fixa na parte inferior */
    #controls {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 15px 0;
      background: rgba(0, 0, 0, 0.8);
      text-align: center;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
    }

    /* Estilo dos bot√µes */
    #controls button {
      padding: 12px 24px;
      margin: 0 10px;
      font-size: 16px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    #controls button:hover {
      background: #f1f1f1;
    }
  </style>
</head>
<body>

  <!-- Player do YouTube -->
  <div id="player"></div>

  <!-- Controles fixos embaixo -->
  <div id="controls">
    <button onclick="previousVideo()">‚è™ Anterior</button>
    <button onclick="nextVideo()">Pr√≥ximo ‚è©</button>
  </div>

  <script>
    const API_KEY = 'AIzaSyBRq-giao8bl3iGBw9zXFdrOpDmmDgFUK4'; // üîë Substitua aqui
    const PLAYLIST_ID = 'PLYXfLV3z1Kzysf0c-wpY6qDuKyj5KHGno'; // üì∫ Sua playlist

    let player;
    let shuffledVideos = [];
    let currentIndex = 0;

    // Carrega a API do YouTube
    function loadYouTubeAPI() {
      const tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      const firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        width: '100%',
        height: '100%',
        playerVars: {
          rel: 0,
          modestbranding: 1,
          enablejsapi: 1,
          autoplay: 0,
          origin: window.location.origin
        },
        events: {
          onReady: onPlayerReady,
          onStateChange: onPlayerStateChange,
          onError: onPlayerError
        }
      });
    }
// ‚úÖ Verifica se o v√≠deo pode ser incorporado (embed)
async function isVideoEmbeddable(videoId) {
  try {
    const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
    if (response.ok) {
      const data = await response.json();
      return !!data.title; // Se retornar t√≠tulo, √© embeddable
    }
  } catch (err) {
    console.warn(`Erro ao verificar v√≠deo ${videoId}:`, err);
  }
  return false; // Se falhar, considera n√£o embeddable
}
    async function fetchAndShufflePlaylist() {
      try {
        let allVideos = [];
        let nextPageToken = '';

        // Busca todos os v√≠deos da playlist (com pagina√ß√£o)
        do {
          const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${PLAYLIST_ID}&maxResults=50&pageToken=${nextPageToken}&key=${API_KEY}`;
          const response = await fetch(url);
          const data = await response.json();

          if (data.error) {
            throw new Error(`Erro da API: ${JSON.stringify(data.error)}`);
          }

          const videoIds = data.items.map(item => item.snippet.resourceId.videoId);
          allVideos.push(...videoIds);
          nextPageToken = data.nextPageToken || '';
        } while (nextPageToken);

        // Embaralha
        shuffledVideos = allVideos.sort(() => Math.random() - 0.5);
        console.log("Playlist embaralhada:", shuffledVideos);

        // Inicia pelo primeiro
        if (shuffledVideos.length > 0) {
          currentIndex = 0;
          player.loadVideoById(shuffledVideos[currentIndex]);
        }

      } catch (err) {
        console.error("Erro ao carregar playlist:", err);
        alert("Erro ao carregar playlist. Verifique sua chave API.");
      }
    }

    function onPlayerReady(event) {
      const alreadyPlayed = sessionStorage.getItem('alreadyPlayed');
      if (!alreadyPlayed) {
        fetchAndShufflePlaylist();
        sessionStorage.setItem('alreadyPlayed', 'true');
      }
    }

    function onPlayerStateChange(event) {
      // Quando o v√≠deo terminar (estado 0)
      if (event.data === YT.PlayerState.ENDED) {
        nextVideo();
      }
    }

    let skipAttempts = 0;
    const MAX_SKIP_ATTEMPTS = 3;

    function nextVideo() {
      if (!shuffledVideos.length) return;

      currentIndex = (currentIndex + 1) % shuffledVideos.length;
      skipAttempts++;

      if (skipAttempts > MAX_SKIP_ATTEMPTS) {
        alert("Muitos v√≠deos com erro. Recarregando playlist...");
        location.reload();
        return;
      }

      player.loadVideoById(shuffledVideos[currentIndex]);
    }

    function previousVideo() {
      if (!shuffledVideos.length) return;

      currentIndex = (currentIndex - 1 + shuffledVideos.length) % shuffledVideos.length;
      skipAttempts = 0; // Reset ao navegar manualmente
      player.loadVideoById(shuffledVideos[currentIndex]);
    }

    function onPlayerError(event) {
      console.warn("Erro no player:", event.data);
      if ([2, 5, 100, 101, 150].includes(event.data)) {
        console.log("Pulando v√≠deo com erro...");
        setTimeout(nextVideo, 1500);
      } else {
        alert("Erro no player: " + event.data);
      }
    }

    // Inicia o carregamento da API
    loadYouTubeAPI();
  </script>

</body>
</html>



