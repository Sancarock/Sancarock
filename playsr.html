<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R√°dio SancaRock</title>
<style>
body {
  margin: 0;
  font-family: 'Bebas Neue', Arial, sans-serif;
  background: radial-gradient(circle at center, #ff4500, #800080, #000);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}
.player-container {
  background: url("img/fundoradio.png") no-repeat center center fixed;
  background-size: cover;
  backdrop-filter: blur(10px);
  border-radius: 25px;
  padding: 25px;
  width: 90%;
  max-width: 460px;
  text-align: center;
  box-shadow: 0 0 30px rgba(0,0,0,0.7);
  border:1px solid rgba(255,69,0,0.3);
}
.album-cover {
  width: 100%;
  max-width: 130px;
  border-radius: 16px;
  border: 3px solid #ff4500;
  margin: 180px auto 15px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.8);
  opacity: 0.5; /* capa semi-transparente por padr√£o */
  transition: opacity 1s ease-in-out;
}
.track-info { margin-top: 10px; font-size: 20px; color: yellow; }
#statusPlayer { margin-top: 8px; font-weight: bold; text-shadow:0 0 5px rgba(255,204,0,0.7);}
.equalizer { display:flex; justify-content:center; gap:6px; height:25px; margin:20px auto; }
.equalizer span { width:8px; background:linear-gradient(180deg,#ff4500,#ff1493,#da70d6); border-radius:3px; animation:bounce 1.2s infinite ease-in-out; }
.equalizer span:nth-child(2){animation-delay:0.15s;}
.equalizer span:nth-child(3){animation-delay:0.3s;}
.equalizer span:nth-child(4){animation-delay:0.45s;}
.equalizer span:nth-child(5){animation-delay:0.6s;}
@keyframes bounce { 0%,100%{transform:scaleY(1);}50%{transform:scaleY(2.8);} }
.equalizer.paused span { animation:none; transform:scaleY(0.2); background:gray; }
.controls { display:flex; justify-content:center; gap:12px; margin-top:20px; flex-wrap:wrap; }
.controls button { padding:12px 20px; font-size:16px; cursor:pointer; border:none; border-radius:25px; color:white; font-weight:bold; }
.play-button{background:linear-gradient(135deg,#28a745,#1e7e34);}
.pause-button{background:linear-gradient(135deg,#dc3545,#c82333);}
.mail-button{background:linear-gradient(135deg,#6f42c1,#5a32a3);}
.atualizar{background:linear-gradient(135deg,#343a40,#23272b);}
.controls button:hover{opacity:1;transform:scale(1.06) translateY(-2px); box-shadow:0 5px 15px rgba(0,0,0,0.4);}
.volume-control{display:flex; align-items:center; justify-content:center; gap:12px; margin-top:20px;}
.volume-control button{background:#1a1a2e;color:#ffcc00;border:1px solid #ff4500;border-radius:50%;width:42px;height:42px;font-weight:bold; cursor:pointer;}
#volumeSlider{width:120px; accent-color:#ff4500;}
#volumeDisplay{min-width:35px;text-align:right;color:#ffcc00;font-weight:bold;}
@media(max-width:480px){.controls button{flex:1 1 30%; font-size:14px;} .track-info{font-size:16px;} }
</style>
</head>
<body>
<div class="player-container">
  <div class="track-info"></div>
  <div class="equalizer paused" id="equalizer">
    <span></span><span></span><span></span><span></span><span></span>
  </div>
  <div id="statusPlayer">‚è∏ Pausado</div>
  <img id="albumCover" src="img/tocar.png" class="album-cover" alt="Capa do √Ålbum">
  <div style="margin-top:10px; display:flex; justify-content:center; gap:30px;">
    <button id="coverMinus">-</button>
    <button id="coverPlus">+</button>
  </div>
  <p id="trackTitle">Clique em Play / Carregando Artista...</p>
  <p id="artistName"></p>
  <div class="controls">
    <button id="playPauseBtn" class="play-button">Play</button>
    <button class="mail-button" onclick="window.location.href='mailto:sancanight@gmail.com?subject=Contato&body=Ol√°!'">Contato</button>
    <button class="atualizar" onclick="history.go(0)">Atualizar</button>
  </div>
  <div class="volume-control">
    <button onclick="adjustVolume(-0.03)">-</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.2">
    <button onclick="adjustVolume(0.03)">+</button>
    <span id="volumeDisplay">20%</span>
  </div>
  <audio id="radioPlayer" preload="auto"></audio>
</div>

<script>
const radio = document.getElementById('radioPlayer');
const playBtn = document.getElementById('playPauseBtn');
const titleEl = document.getElementById('trackTitle');
const artistEl = document.getElementById('artistName');
const coverEl = document.getElementById('albumCover');
const statusEl = document.getElementById('statusPlayer');
const volumeSlider = document.getElementById('volumeSlider');
const volumeDisplay = document.getElementById('volumeDisplay');
const apiKeyLastFm = 'd08d389671438f325d13d64f0c94b583';
const coverMinus = document.getElementById('coverMinus');
const coverPlus = document.getElementById('coverPlus');
const equalizer = document.getElementById('equalizer'); 

radio.src = "https://s02.transmissaodigital.com:6716/stream;"; // streaming direto HTTPS
let lastTrack = '';

// ---------------- Opacidade ----------------
let coverOpacity = 0.8;
coverEl.style.opacity = coverOpacity;

// Bot√µes capa
coverMinus.onclick = () => {
  coverOpacity = Math.max(0, coverOpacity - 0.2);
  coverEl.style.opacity = coverOpacity.toFixed(2);
};
coverPlus.onclick = () => {
  coverOpacity = Math.min(1, coverOpacity + 0.2);
  coverEl.style.opacity = coverOpacity.toFixed(2);
};

// ---------------- Volume ----------------
// Ajusta volume com bot√µes
function adjustVolume(change){
  let v = parseFloat(radio.volume) || 0;
  v = Math.min(1, Math.max(0, v + change));
  radio.volume = v;
  volumeSlider.value = v;
  volumeDisplay.textContent = Math.round(v*100) + '%';
}

// Slider de volume
volumeSlider.oninput = () => {
  let v = parseFloat(volumeSlider.value);
  radio.volume = v;
  volumeDisplay.textContent = Math.round(v*100) + '%';
};

// ---------------- Play/Pause ----------------
equalizer.classList.add('paused');

// Play / Pause
playBtn.onclick = () => {
  if (radio.paused) {
    radio.play().then(() => {
      playBtn.textContent = 'Pause';
      playBtn.className = 'pause-button';
      statusEl.textContent = 'üîä Ao vivo';
      equalizer.classList.remove('paused'); // equalizer animado
    });
  } else {
    radio.pause();
    playBtn.textContent = 'Play';
    playBtn.className = 'play-button';
    statusEl.textContent = '‚è∏ Pausado';
    equalizer.classList.add('paused'); // equalizer parado
  }
};

// ---------------- Decodifica HTML entities ----------------
function decodeHtmlEntities(str){
  const txt = document.createElement('textarea');
  txt.innerHTML = str;
  return txt.value;
}

// ---------------- Metadados ----------------
async function updateMetadata(){
  try{
    const res = await fetch('https://transmissaodigital.com/api/VG1wamVFNW5QVDA9KzU=');
    const buffer = await res.arrayBuffer();
    let afterKbps = new TextDecoder('iso-8859-1').decode(buffer)
      .split('Kbps').pop()
      .replace(/https?:\/\/[^\s]*/g,'')
      .replace(/<[^>]*>/g,'')
      .trim();

    if(!afterKbps || afterKbps === lastTrack) return;
    lastTrack = afterKbps;

    afterKbps = afterKbps.replace(/(\d+,)+\d+,?/g,'').trim();

    let artist='', track='';
    if(afterKbps.includes(' - ')){
      [artist, track] = afterKbps.split(' - ').map(s=>s.trim());
    } else { track = afterKbps; }

    track = decodeHtmlEntities(track);
    artist = decodeHtmlEntities(artist);

    titleEl.textContent = track;
    artistEl.textContent = artist;
    document.title = `${artist} - ${track} | R√°dio SancaRock`;

    // ---------------- Capas ----------------
    if((artist + ' ' + track).toLowerCase().includes('monstros do rock')){
      coverEl.src = 'img/monstrosdorock.png';
    } else {
      let cover = await fetchCoveriTunes(artist || track, track);
      if(!cover) cover = await fetchCoverLastFm(artist || track, track);
      coverEl.src = cover || 'img/sanca.png';
    }

    // üîπ efeito destaque r√°pido
    coverEl.style.opacity = 1;
    setTimeout(()=>{ coverEl.style.opacity = coverOpacity; }, 1000);

  } catch(e){ console.warn(e); }
}

// ---------------- Busca capas ----------------
async function fetchCoveriTunes(artist, track){
  try{
    const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(artist+' '+track)}&entity=song&limit=5`);
    const data = await res.json();
    if(data.results?.length>0){
      const match = data.results.find(r=>r.artistName.toLowerCase().includes(artist.toLowerCase()));
      if(match) return match.artworkUrl100.replace("100x100","600x600");
    }
  } catch(e){ return null; }
  return null;
}

async function fetchCoverLastFm(artist, track){
  try{
    const res = await fetch(`https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${apiKeyLastFm}&artist=${encodeURIComponent(artist)}&track=${encodeURIComponent(track)}&format=json`);
    const data = await res.json();
    const images = data?.track?.album?.image;
    if(images) return images.find(img=>img.size==='extralarge')?.['#text'];
  } catch(e){ return null; }
  return null;
}

// ---------------- Loop ----------------
setInterval(updateMetadata, 30000);

// ---------------- Init ----------------
document.addEventListener('DOMContentLoaded', ()=>{
  radio.volume = parseFloat(volumeSlider.value);
  volumeDisplay.textContent = Math.round(radio.volume*100)+'%';
});

</script>
</body>
</html>



