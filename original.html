<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rádio SancaRock</title>
<style>
body { margin:0; font-family:'Bebas Neue', Arial; background: radial-gradient(circle at center,#ff4500,#800080,#000); color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px; }
.player-container { background: url("img/fundoradio.png") no-repeat center center fixed; background-size:cover; backdrop-filter:blur(10px); border-radius:25px; padding:25px; width:90%; max-width:460px; text-align:center; box-shadow:0 0 30px rgba(0,0,0,0.7); border:1px solid rgba(255,69,0,0.3); }
.album-cover { width:100%; max-width:130px; border-radius:16px; border:3px solid #ff4500; margin:220px auto 15px; box-shadow:0 6px 20px rgba(0,0,0,0.8); }
.track-info { margin-top:15px; font-size:20px; color:yellow; }
.controls { display:flex; justify-content:center; margin-top:20px; gap:12px; }
.controls button { padding:12px 20px; font-size:16px; cursor:pointer; color:white; border:none; border-radius:25px; font-weight:bold; }
.play-button{background:linear-gradient(135deg,#28a745,#1e7e34);}
.pause-button{background:linear-gradient(135deg,#dc3545,#c82333);}
.equalizer { display:flex; gap:6px; height:25px; justify-content:center; margin-top:15px; }
.equalizer span { width:8px; background:linear-gradient(180deg,#ff4500,#ff1493,#da70d6); animation:bounce 1.2s infinite ease-in-out; border-radius:3px; }
@keyframes bounce {0%,100%{transform:scaleY(1);}50%{transform:scaleY(2.8);}}
</style>
</head>
<body>
<div class="player-container">
  <img id="albumCover" src="img/tocar.png" alt="Capa do Álbum" class="album-cover">
  <p id="trackTitle">Se não iniciar, Clique em Play</p>
  <p id="artistName"></p>
  
  <div class="equalizer" id="equalizer">
    <span></span><span></span><span></span><span></span><span></span>
  </div>

  <div class="controls">
    <button id="playPauseBtn" class="play-button" onclick="togglePlayPause()">Play</button>
  </div>

  <audio id="radioPlayer" preload="auto"></audio>
</div>

<script>
const radioPlayer = document.getElementById('radioPlayer');
const playPauseBtn = document.getElementById('playPauseBtn');
const trackTitle = document.getElementById('trackTitle');
const artistName = document.getElementById('artistName');
const albumCover = document.getElementById('albumCover');
const equalizer = document.getElementById('equalizer');

let lastTrack = "";

async function startPlayer() {
  // Coloque aqui o stream do seu servidor (pode ser do listen.pls ou direto URL do stream)
  const streamUrl = "https://s02.transmissaodigital.com:6716/stream;";
  radioPlayer.src = streamUrl;
  radioPlayer.play().catch(()=>{});

  // Atualiza metadados
  updateMetadataLoop();
  setInterval(updateMetadataLoop, 30000);
  setInterval(updateStatus, 1000);
}

function togglePlayPause(){
  if(radioPlayer.paused){
    radioPlayer.play();
    playPauseBtn.textContent = "Pause";
    playPauseBtn.className = "pause-button";
    equalizer.style.display = "flex";
  } else {
    radioPlayer.pause();
    playPauseBtn.textContent = "Play";
    playPauseBtn.className = "play-button";
    equalizer.style.display = "none";
  }
  updateStatus();
}

function updateStatus(){
  equalizer.style.opacity = radioPlayer.paused ? "0.3" : "1";
}

// ---------------- Puxa metadados ---------------- //
async function updateMetadataLoop(){
  try {
    // Endpoint do seu servidor Shoutcast/Icecast que retorna JSON (CORS deve estar habilitado)
    const res = await fetch('https://transmissaodigital.com/api/VG1wamVFNW5QVDA9KzU=');
    const buffer = await res.arrayBuffer();
    const text = new TextDecoder('iso-8859-1').decode(buffer);

    // Limpeza do texto e remoção de números indesejados
    let meta = text.slice(text.lastIndexOf('Kbps')+4).replace(/(\d+,)+\d+,?/g,'').replace(/<[^>]*>/g,'').trim();
    if(!meta || meta===lastTrack) return;
    lastTrack = meta;

    // Divide artista e música
    let artist='', track='';
    if(meta.includes(' - ')){
      [artist, track] = meta.split(' - ').map(s=>s.trim());
    } else {
      track = meta;
      artist = '';
    }

    trackTitle.textContent = track;
    artistName.textContent = artist;
    document.title = `${artist} - ${track} | Rádio SancaRock`;

    // Capa padrão (sem busca externa)
    albumCover.src = 'img/sanca.png';
    
  } catch(e){
    console.warn("Erro ao buscar metadados:", e);
  }
}

// ---------------- Inicia ---------------- //
document.addEventListener('DOMContentLoaded', ()=>{
  radioPlayer.volume = 0.2;
  updateStatus();
  startPlayer();
  window.togglePlayPause = togglePlayPause;
});
</script>
</body>
</html>
