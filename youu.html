<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player YouTube Aleat√≥rio</title>
  <style>
    body {
      margin: 0;
      background: #191919;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    /* Container para posicionar o loading por cima do player */
    #container {
      position: relative;
      width: 100%;
      max-width: 560px;
      height: 315px;
      border-radius: 12px;
      overflow: hidden;
    }

    /* Player sempre vis√≠vel para evitar tela preta */
    #player {
      width: 100%;
      height: 100%;
      background: #000;
    }

    /* Loading com tamanho exato 500x300 */
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    #loading img {
      width: 500px;
      height: 300px;
      object-fit: contain;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #800000;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #a00000;
    }
  </style>
</head>
<body>

  <!-- Player + Loading por cima -->
  <div id="container">
    <div id="player"></div>
    <div id="loading">
      <img src="img/loading.gif" alt="Carregando...">
    </div>
  </div>

  <div class="controls">
    <button onclick="nextVideo()">Pr√≥ximo ‚ñ∂</button>
    <button onclick="playRandomVideo()">üîÑ Aleat√≥rio</button>
    <button onclick="toggleFullscreen()">‚õ∂ Tela Cheia</button>
  </div>

  <!-- Carrega API do YouTube -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
  let player;
  let videoIds = []; // ‚Üê Vamos carregar os IDs manualmente
  const PLAYLIST_ID = 'PLYXfLV3z1Kzysf0c-wpY6qDuKyj5KHGno';
  const API_KEY = 'AIzaSyBRq-giao8bl3iGBw9zXFdrOpDmmDgFUK4'; // ‚ö†Ô∏è SUBSTITUA POR SUA CHAVE!

  function onYouTubeIframeAPIReady() {
    console.log("‚úÖ API do YouTube carregada. Inicializando player...");

    player = new YT.Player('player', {
      width: '100%',
      height: '100%',
      playerVars: {
        rel: 0,
        modestbranding: 1,
        autoplay: 1,
        controls: 1
      },
      events: {
        onReady: onPlayerReady,
        onStateChange: onPlayerStateChange,
        onError: onPlayerError
      }
    });

    // Carrega os IDs da playlist via API
    loadPlaylistVideoIds();
  }

  async function loadPlaylistVideoIds() {
    console.log("‚è≥ Carregando lista de v√≠deos da playlist...");

    try {
      let nextPageToken = '';
      let allVideoIds = [];

      // Busca at√© 200 v√≠deos (ajuste se precisar de mais)
      for (let i = 0; i < 4; i++) { // 4 p√°ginas x 50 v√≠deos = 200 v√≠deos
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${PLAYLIST_ID}&maxResults=50&pageToken=${nextPageToken}&key=${API_KEY}`;
        const response = await fetch(url);
        const data = await response.json();

        if (!data.items || data.items.length === 0) break;

        for (let item of data.items) {
          if (item.snippet?.resourceId?.videoId) {
            allVideoIds.push(item.snippet.resourceId.videoId);
          }
        }

        nextPageToken = data.nextPageToken || '';
        if (!nextPageToken) break;
      }

      videoIds = allVideoIds;
      console.log(`‚úÖ Carregados ${videoIds.length} v√≠deos v√°lidos.`);
    } catch (error) {
      console.error("‚ùå Erro ao carregar playlist:", error);
      // Fallback: usa alguns v√≠deos conhecidos
      videoIds = ['dQw4w9WgXcQ', 'JGwWNGJdvx8', 'kJQP7kiw5Fk'];
    }
  }

  function onPlayerReady(event) {
    console.log("‚úÖ Player pronto. Aguardando carregamento da playlist...");

    // Tenta tocar v√≠deo aleat√≥rio ap√≥s 1 segundo (d√° tempo de carregar a lista)
    setTimeout(playRandomVideo, 1000);
  }

  function playRandomVideo() {
    if (videoIds.length === 0) {
      console.warn("‚ö†Ô∏è Nenhum v√≠deo carregado. Tentando novamente...");
      setTimeout(playRandomVideo, 1000);
      return;
    }

    const randomId = videoIds[Math.floor(Math.random() * videoIds.length)];
    console.log(`‚ñ∂Ô∏è Tocando v√≠deo: ${randomId}`);

    player.loadVideoById(randomId); // ‚Üê MELHOR que playVideoAt + shuffle
  }

  function onPlayerStateChange(event) {
    console.log("üîÑ Estado:", event.data);

    if (event.data === YT.PlayerState.BUFFERING || event.data === YT.PlayerState.PLAYING) {
      const loading = document.getElementById('loading');
      if (loading) {
        loading.style.display = 'none';
        console.log("‚úÖ Loading escondido.");
      }
    }

    // Se o v√≠deo terminar, toca outro aleat√≥rio
    if (event.data === YT.PlayerState.ENDED) {
      console.log("‚èπÔ∏è V√≠deo terminou. Tocando pr√≥ximo aleat√≥rio...");
      playRandomVideo();
    }
  }

  function onPlayerError(event) {
    console.error("‚ùå Erro no player:", event.data);

    // C√≥digos comuns: 2 (inv√°lido), 100 (n√£o encontrado), 101/150 (restrito)
    if ([2, 100, 101, 150].includes(event.data)) {
      console.log("üîÑ Tentando outro v√≠deo...");
      setTimeout(playRandomVideo, 1000);
    }
  }

  function nextVideo() {
    playRandomVideo();
  }

  function previousVideo() {
    playRandomVideo(); // Ou implemente hist√≥rico se quiser
  }

  function toggleFullscreen() {
    const container = document.getElementById('container');
    if (!document.fullscreenElement) {
      if (container.requestFullscreen) container.requestFullscreen();
      else if (container.webkitRequestFullscreen) container.webkitRequestFullscreen();
      else if (container.msRequestFullscreen) container.msRequestFullscreen();
    } else {
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();
    }
  }
</script>
</body>
</html>